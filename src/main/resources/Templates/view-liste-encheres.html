<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <title>Liste des enchères</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script th:src="@{/js/script.js}" defer></script>
</head>
<body class="page-enchere">

<div th:replace="~{fragements/fragement-entete :: mainNav}"></div>

<h1>Liste des enchères</h1>

<form th:action="@{/encheres}" method="get" class="form-filtres">
    <div class="filtres">
        <label for="nomArticle">Filtres :</label>
        <input type="text" id="nomArticle" name="nomArticle"
               th:value="${nomRecherche}" placeholder="Nom de l'article" />

        <label for="categorie">Catégorie :</label>
        <select id="categorie" name="categorie">
            <option value="0" th:selected="${categorieRecherche == 0}">Toutes</option>
            <option th:each="cat : ${categories}"
                    th:value="${cat.idCategorie}"
                    th:text="${cat.libelle}"
                    th:selected="${cat.idCategorie == categorieRecherche}">
            </option>
        </select>
    </div>

    <div class="recherche-btn">
        <button type="submit">Rechercher</button>
    </div>

    <div th:if="${user != null}">
        <div class="radio-filtres">
            <label sec:authorize="isAuthenticated()">
                <input type="radio" name="typeFiltre" value="achat"
                       th:checked="${achatEncheresOuvertes or achatMesEncheres or achatMesEncheresRemportees}"/> Achat
            </label>
            <label sec:authorize="isAuthenticated()">
                <input type="radio" name="typeFiltre" value="vente"
                       th:checked="${venteMesVentesEnCours or venteVentesNonDebutees or venteVentesTerminees}"/> Ventes
            </label>
        </div>

        <fieldset id="filtresAchat">
            <legend>Achat</legend>
            <label><input type="checkbox" name="achatEncheresOuvertes" th:checked="${achatEncheresOuvertes}"/> Enchères ouvertes</label><br/>
            <label><input type="checkbox" name="achatMesEncheres" th:checked="${achatMesEncheres}"/> Mes enchères</label><br/>
            <label><input type="checkbox" name="achatMesEncheresRemportees" th:checked="${achatMesEncheresRemportees}"/> Mes enchères remportées</label>
        </fieldset>

        <fieldset id="filtresVente">
            <legend>Ventes</legend>
            <label><input type="checkbox" name="venteMesVentesEnCours" th:checked="${venteMesVentesEnCours}"/> Mes ventes en cours</label><br/>
            <label><input type="checkbox" name="venteVentesNonDebutees" th:checked="${venteVentesNonDebutees}"/> Ventes non débutées</label><br/>
            <label><input type="checkbox" name="venteVentesTerminees" th:checked="${venteVentesTerminees}"/> Ventes terminées</label>
        </fieldset>
    </div>
</form>

<hr>

<div th:if="${#lists.isEmpty(encheres)}">
    <p class="empty-message">Aucune enchère en cours pour cette recherche.</p>
</div>

<div class="auction-list" th:each="enchere : ${encheres}">
    <div class="auction-card">
        <div class="card-content">
            <a th:href="@{/article/{id}(id=${enchere.article.idArticle})}"
               class="auction-title"
               th:text="${enchere.article.nomArticle}">Nom article</a>
            <p th:text="${enchere.article.description}">Description</p>
            <p><span class="label">Catégorie :</span> <span th:text="${enchere.article.categorie.libelle}">Informatique</span></p>
            <p><span class="label">Fin :</span>
                <span th:text="${#temporals.format(enchere.article.dateFinEncheres, 'dd/MM/yyyy')}">Date fin</span>
            </p>
            <p><span class="label">Mise à prix :</span> <span th:text="${enchere.article.miseAPrix}">100</span> pts</p>
            <a th:href="@{/articles/{id}(id=${enchere.article.idArticle})}"
               class="detail-button">Voir détail et enchérir</a>
            <p><span class="label">Vendeur :</span>
                <a th:href="@{/utilisateur/profil(pseudo=${enchere.article.vendeur.pseudo})}"
                   th:text="${enchere.article.vendeur.pseudo}">pseudo</a>
            </p>
        </div>
    </div>
</div>

</body>
</html>
