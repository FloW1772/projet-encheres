<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Modifier Profil</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
      /* Style pour le bouton oeil dans le champ mot de passe */
      .password-wrapper {
        position: relative;
        display: inline-block;
        width: 100%;
      }
      .toggle-password-btn {
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background: none;
        cursor: pointer;
        font-size: 1.2em;
        color: #007bff;
      }
    </style>
</head>
<body>

<nav style="background: #007bff; padding: 10px;">
  <ul style="list-style: none; display: flex; gap: 15px; color: white; margin: 0;">
    <li><a th:href="@{/}" style="color: white;">Accueil</a></li>
    <li><a th:href="@{/vente/mes-ventes}" style="color: white;">Mes ventes</a></li>
    <li><a th:href="@{/vente/mes-encheres}" style="color: white;">Mes enchères</a></li>
    <li><a th:href="@{/vente/creation}" style="color: white;">Créer une vente</a></li>
    <li><a th:href="@{/utilisateur/modifier}" style="color: white;">Profil</a></li>
    <li>
      <form th:action="@{/logout}" method="post" style="display: inline;">
        <button type="submit" 
                style="background: none; border: none; color: white; cursor: pointer; padding: 0; font: inherit;">
          Se déconnecter
        </button>
      </form>
    </li>
  </ul>
</nav>

<main>
    <h1>Modifier mon profil</h1>

    <div th:if="${errors != null}">
        <ul style="color: red;">
            <li th:each="err : ${errors}" th:text="${err}"></li>
        </ul>
    </div>

    <form th:action="@{/utilisateur/modifier}" method="post" th:object="${utilisateur}">
        <input type="hidden" th:field="*{idUtilisateur}" />
        
        <!-- Champs cachés pour les rôles -->
        <div th:each="role, iterStat : ${utilisateur.roles}">
            <input type="hidden" th:name="'roles[' + ${iterStat.index} + '].idRole'" th:value="${role.idRole}" />
            <input type="hidden" th:name="'roles[' + ${iterStat.index} + '].libelle'" th:value="${role.libelle}" />
        </div>

        <ul class="flex-outer">

            <li>
                <label for="inputPseudo">Pseudo</label>
                <input type="text" id="inputPseudo" th:field="*{pseudo}" required />
                <p class="error-message" th:if="${#fields.hasErrors('pseudo')}" th:errors="*{pseudo}"></p>
            </li>

            <li>
                <label for="inputNom">Nom</label>
                <input type="text" id="inputNom" th:field="*{nom}" required />
                <p class="error-message" th:if="${#fields.hasErrors('nom')}" th:errors="*{nom}"></p>
            </li>

            <li>
                <label for="inputPrenom">Prénom</label>
                <input type="text" id="inputPrenom" th:field="*{prenom}" required />
                <p class="error-message" th:if="${#fields.hasErrors('prenom')}" th:errors="*{prenom}"></p>
            </li>

            <li>
                <label for="inputTelephone">Téléphone</label>
                <input type="text" id="inputTelephone" th:field="*{telephone}" required />
                <p class="error-message" th:if="${#fields.hasErrors('telephone')}" th:errors="*{telephone}"></p>
            </li>

            <li>
                <label for="inputEmail">Email</label>
                <input type="email" id="inputEmail" th:field="*{email}" required />
                <p class="error-message" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></p>
            </li>

            <li>
                <label for="inputCredit">Crédit</label>
                <input type="number" id="inputCredit" th:field="*{credit}" min="0" step="0.01" required />
                <p class="error-message" th:if="${#fields.hasErrors('credit')}" th:errors="*{credit}"></p>
            </li>

        
    <li>
    <label for="inputMotDePasse">Mot de passe (laisser vide si inchangé)</label>
    <input type="password" id="inputMotDePasse" th:field="*{motDePasse}" autocomplete="new-password" />
    <p><small>Laisser vide si vous ne souhaitez pas modifier le mot de passe.</small></p>
    <p class="error-message" th:if="${#fields.hasErrors('motDePasse')}" th:errors="*{motDePasse}"></p>
</li>

<li>
    <label for="inputConfMotDePasse">Confirmer le mot de passe</label>
    <input type="password" id="inputConfMotDePasse" name="confirmationMotDePasse" autocomplete="new-password" />
    <p class="error-message" th:if="${confirmationMotDePasseError != null}" th:text="${confirmationMotDePasseError}"></p>
</li>


            <!-- Adresse -->
            <li>
                <label for="inputRue">Rue</label>
                <input type="text" id="inputRue" th:field="*{adresse.rue}" required />
                <p class="error-message" th:if="${#fields.hasErrors('adresse.rue')}" th:errors="*{adresse.rue}"></p>
            </li>

            <li>
                <label for="inputCodePostal">Code Postal</label>
                <input type="text" id="inputCodePostal" th:field="*{adresse.codePostal}" required />
                <p class="error-message" th:if="${#fields.hasErrors('adresse.codePostal')}" th:errors="*{adresse.codePostal}"></p>
            </li>

            <li>
                <label for="inputVille">Ville</label>
                <input type="text" id="inputVille" th:field="*{adresse.ville}" required />
                <p class="error-message" th:if="${#fields.hasErrors('adresse.ville')}" th:errors="*{adresse.ville}"></p>
            </li>

            <li>
                <label for="inputPays">Pays</label>
                <input type="text" id="inputPays" th:field="*{adresse.pays}" required />
                <p class="error-message" th:if="${#fields.hasErrors('adresse.pays')}" th:errors="*{adresse.pays}"></p>
            </li>
            <input type="hidden" th:field="*{adresse.idAdresse}" />

         
            <li th:if="${estSimpleUtilisateur}">
                <p>Vous êtes un simple utilisateur.</p>
                <button type="submit" name="action" value="devenirVendeur">Devenir vendeur</button>
            </li>

            <li th:unless="${estSimpleUtilisateur}">
                <label>Rôles :</label>
                <ul>
                    <li th:each="role : ${utilisateur.roles}" th:text="${role.libelle}"></li>
                </ul>
            </li>

            <li>
                <button type="submit" name="action" value="enregistrer">Enregistrer</button>
                <button type="reset">Annuler</button>
            </li>
        </ul>
    </form>
	
		<form th:action="@{/utilisateur/supprimer}" method="post" 
     	 onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible.');"
      	style="margin-top: 20px;">
    	<button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 10px 15px; cursor: pointer;">
        Supprimer mon compte
    	</button>
</form>
</main>


</body>
</html>
